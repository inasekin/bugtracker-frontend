#!/usr/bin/env sh
. "$(dirname -- "$0")/_/husky.sh"

echo "ğŸš€ Running pre-push checks..."

# ĞŸĞ¾Ğ»ÑƒÑ‡Ğ°ĞµĞ¼ Ğ¸Ğ½Ñ„Ğ¾Ñ€Ğ¼Ğ°Ñ†Ğ¸Ñ Ğ¾ Ñ‚Ğ¾Ğ¼, ĞºÑƒĞ´Ğ° Ğ¿ÑƒÑˆĞ¸Ğ¼
remote="$1"
url="$2"

echo "ğŸ“¡ Pushing to: $remote ($url)"

# ĞŸĞ¾Ğ»Ğ½Ğ°Ñ Ğ¿Ñ€Ğ¾Ğ²ĞµÑ€ĞºĞ° Ğ»Ğ¸Ğ½Ñ‚Ğ¸Ğ½Ğ³Ğ° Ğ²ÑĞµĞ³Ğ¾ Ğ¿Ñ€Ğ¾ĞµĞºÑ‚Ğ°
echo "ğŸ” Running full project linting..."
npm run lint

if [ $? -ne 0 ]; then
  echo "âŒ Linting failed. Please fix all linting errors before pushing."
  echo "ğŸ’¡ Run 'npm run lint:fix' to auto-fix some issues."
  exit 1
fi

# ĞŸÑ€Ğ¾Ğ²ĞµÑ€ĞºĞ° Ñ‚Ğ¸Ğ¿Ğ¾Ğ²
echo "ğŸ”§ Running TypeScript type check..."
npm run type-check

if [ $? -ne 0 ]; then
  echo "âŒ TypeScript type check failed. Please fix type errors before pushing."
  exit 1
fi

# ĞŸÑ€Ğ¾Ğ²ĞµÑ€ĞºĞ° Ñ„Ğ¾Ñ€Ğ¼Ğ°Ñ‚Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¸Ñ
echo "ğŸ¨ Checking code formatting..."
npm run format:check

if [ $? -ne 0 ]; then
  echo "âŒ Code formatting check failed."
  echo "ğŸ’¡ Run 'npm run format' to fix formatting issues."
  exit 1
fi

# ĞŸÑ€Ğ¾Ğ²ĞµÑ€ĞºĞ° ÑĞ±Ğ¾Ñ€ĞºĞ¸
echo "ğŸ—ï¸ Building project..."
npm run build

if [ $? -ne 0 ]; then
  echo "âŒ Build failed. Please fix build errors before pushing."
  exit 1
fi

echo ""
echo "âœ… All pre-push checks passed! ğŸ‰"
echo "ğŸš€ Ready to push to $remote"
