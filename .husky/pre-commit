#!/usr/bin/env sh
. "$(dirname -- "$0")/_/husky.sh"

echo "ğŸ” Running pre-commit checks..."

# ĞŸÑ€Ğ¾Ğ²ĞµÑ€ÑĞµĞ¼, ĞµÑÑ‚ÑŒ Ğ»Ğ¸ staged Ñ„Ğ°Ğ¹Ğ»Ñ‹
if git diff --cached --quiet; then
  echo "âš ï¸  No staged changes found. Skipping pre-commit checks."
  exit 0
fi

# Ğ—Ğ°Ğ¿ÑƒÑĞº Ğ»Ğ¸Ğ½Ñ‚ĞµÑ€Ğ¾Ğ² Ğ¸ Ñ„Ğ¾Ñ€Ğ¼Ğ°Ñ‚Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¸Ñ Ñ‚Ğ¾Ğ»ÑŒĞºĞ¾ Ğ´Ğ»Ñ staged Ñ„Ğ°Ğ¹Ğ»Ğ¾Ğ²
echo "ğŸ¨ Running linters and formatters on staged files..."
npx lint-staged

if [ $? -ne 0 ]; then
  echo "âŒ Linting/formatting failed. Please fix the issues and try again."
  exit 1
fi

# ĞŸÑ€Ğ¾Ğ²ĞµÑ€ĞºĞ° Ñ‚Ğ¸Ğ¿Ğ¾Ğ² TypeScript
echo "ğŸ”§ Type checking..."
npm run type-check

if [ $? -ne 0 ]; then
  echo "âŒ TypeScript type check failed. Please fix type errors before committing."
  echo "ğŸ’¡ Hint: Run 'npm run type-check' to see detailed errors."
  exit 1
fi

echo "âœ… All pre-commit checks passed! ğŸ‰"
